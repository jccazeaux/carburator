/*!
 * carburator - 0.2.0 https://github.com/jccazeaux/carburator
 *  Copyright (c) 2015 Jean-Christophe Cazeaux.
 *  Licensed under the MIT license.
 * 
 */
!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.carburator=e():n.carburator=e()}(this,function(){return function(n){function e(o){if(t[o])return t[o].exports;var r=t[o]={exports:{},id:o,loaded:!1};return n[o].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var t={};return e.m=n,e.c=t,e.p="",e(0)}([function(n,e){"use strict";function t(n){return"function"==typeof n?n():n}function o(n){if(!f.test(n))throw"Container name must contains only letters or numbers, and start by a letter or $ or _";if(void 0!==l[n]&&null!==l[n])throw"Container "+n+" already exists";return function(e,t){if(void 0===t)return l[n][e];if(v.log("adding "+e+" to "+n),!p&&null!=l[n][e])throw"Object "+e+" already exists in container "+n+".";return l[n][e]={name:e,obj:t,scope:"singleton"},{asPrototype:function(){l[n][e].scope="prototype"},asSingleton:function(){l[n][e].scope="singleton"}}}}function r(n,e,t,o){if(c(n)){v.log("injecting array:",n);for(var r=[],u=0;u<n.length-1;u++)null!=e&&void 0!==e[n[u]]?r[u]=Promise.resolve(e[n[u]]):r[u]=i(n[u],o);return Promise.all(r).then(function(e){return n[n.length-1].apply(t,e)})}return"function"==typeof n?(v.log("injecting function:",n),Promise.resovle(n.call(t))):(v.log("injecting obj:",n),Promise.resolve(n))}function i(n,e){var t,o,r,i;v.log("searchDependency for "+n);var c=new RegExp("(.+):(.+)"),f=c.exec(n);if(null===f||void 0===l[f[1]]||e&&-1===e.indexOf(f[1])){for(var s in l)if(!e||-1!==e.indexOf(s)){v.log("container:"+s),t=l[s];for(var a in t)v.log("injectionName:"+i),a===n&&(i=n,o=t[a],r=s)}}else o=l[f[1]][f[2]],r=f[1],i=f[2];return null!=o?"prototype"===o.scope?(v.log("as prototype"),u(o.name,o.obj,r,e)):o.instance?Promise.resolve(o.instance):u(o.name,o.obj,r,e).then(function(n){return o.instance=n,n}):Promise.reject("Injection "+n+" doesn't exist")}function c(n){if(!Array.isArray(n))return!1;for(var e=0;e<n.length-1;e++)if("string"!=typeof n[e])return!1;return"function"!=typeof n[n.length-1]?!1:!0}function u(n,e,o,r){if(c(e)){v.log("injecting array:",e);for(var u=[],f=a[o],s=0;s<e.length-1;s++)f&&f[e[s]]?u[s]=Promise.resolve(f[e[s]](n)):u[s]=i(e[s],r);return Promise.all(u).then(function(n){return e[e.length-1].apply(null,n)})}var l=g[o]||t;return Promise.resolve(l(e))}var f=new RegExp("^[$A-Za-z_][0-9A-Za-z_$]*$"),s={},l={},a={},g={},p=!0,d={debug:function(){},error:function(){},info:function(){},warn:function(){},log:function(){}},v=d;s.config={},s.config.container=function(n){return s[n]=o(n),l[n]={},this},s.config.executor=function(n,e){return g[n]=e,this},s.config.automaticDependencies=function(n,e){return a[n]=e,this},s.config.debug=function(n){return v=n?console:d,this},s.config.overwrites=function(n){return p=n,this},s.selectContainers=function(n){return{inject:function(e,t,o){return r(e,t,o,n)}}},s.inject=function(n,e,t){return r(n,e,t)},s.reset=function(n){if(void 0===n){v.log("Resetting all...");for(var e in l)delete s[e],delete g[e];l={}}else{if(!l[n])throw"Cannot reset "+n+" : it doesn't exist.";v.log("Resetting container "+n),delete s[n],delete l[n],delete g[n]}return this},s.clear=function(n){if(void 0===n){v.log("Clearing all containers...");for(var e in l)l[e]={}}else{if(!l[n])throw"Cannot clear container "+n+" : it doesn't exist.";v.log("Clearing container "+n),l[n]={}}return this},n.exports=s}])});